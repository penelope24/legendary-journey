# 股票筛选算法规则

## 算法概述
该算法通过分析股票的历史价格走势，识别关键价格点位，并预测可能的低点位置。算法分为两个阶段：
1. 历史高点和低点检测
2. 低点的回调与新低点预测

## Stage 1：历史高点和低点检测

### 1. 时间范围定义
- 主要分析区间：2012年至今
- 对于2012年之前的历史数据：
  - 正常显示价格波形
  - 在图表上特别标记2012年后的分析区间

### 2. 显著高点识别
- 使用zigzag等技术识别所有波峰
- 确定历史最高点（时间t，价格p）
- 设定价格阈值：历史最高点价格的85%
- 识别所有超过该阈值的波峰，标记为显著高点

### 3. 关键最高点确定
- 在历史最高点前后各一年的时间窗口内：
  - 如果存在显著高点：选择时间上最近的显著高点的时间t，但保持历史最高点的价格p
  - 如果不存在显著高点：直接使用历史最高点的时间和价格(t, p)

### 4. 预测规则
- 设定预测低点：low = 0.3 * p（最高点价格的30%）
- 设定时间窗口：con = t + 3.5年
- 判断标准：
  1. 必要条件：必须见到预测低点low
  2. 时间分类：
     - 如果低点在con之前出现：标记为"提前出现"
     - 如果低点在con之后出现：标记为"符合标准"
     - 如果未见到低点：标记为"不满足条件"

### 5. 输出结果
- 对于每只股票，输出其：
  - 历史最高点信息（时间、价格）
  - 预测低点价格（0.3 * p）
  - 时间窗口截止日期
  - 实际低点信息（如果存在）：
    - 出现时间
    - 实际价格
    - 是否提前出现（相对于时间窗口）
  - 判断结果：
    - 如果见到低点：
      - "提前出现"：低点在时间窗口前出现
      - "符合标准"：低点在时间窗口后出现
    - "不满足条件"：未见到预测低点

## Stage 2：低点的回调与新低点预测

### 1. 输入条件
- 仅处理Stage 1中成功捕捉到实际低点的股票
- 输入数据：第一低点的时间t和价格p

### 2. 价格回调判断
- 判断标准：如果在第一低点之后，某一时刻的价格相比低点价格上涨幅度超过70%
- 计算公式：回调判断 = (当前价格 - 第一低点价格) / 第一低点价格 > 0.7

### 3. 第二低点预测
- 触发条件：出现价格回调
- 预测方法：第二低点价格 = 回调价格 * 0.3
- 注意：第二低点只预测价格，不预测时间

### 4. 输出结果
- 判断结果：
  - "出现回调"：价格涨幅超过70%
  - "未出现回调"：价格涨幅未达到70%
- 如果出现回调，额外输出：
  - 第二低点预测价格
  